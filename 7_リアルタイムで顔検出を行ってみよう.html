<h1 id="シリーズ記事一覧"><strong>シリーズ記事一覧</strong></h1>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">タイトル リンク</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>第1回</strong></td>
<td style="text-align: center;"><a
href="https://qiita.com/yuta3003/items/302ae91e6f4ab7164d9b">環境構築</a></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>第2回</strong></td>
<td style="text-align: center;"><a
href="https://qiita.com/yuta3003/items/a51dbfea2c942ffdbec2">Python
概要</a></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>第3回</strong></td>
<td style="text-align: center;"><a
href="https://qiita.com/yuta3003/items/178c238c387faecc8d13">Python
基礎</a></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>第4回</strong></td>
<td style="text-align: center;"><a
href="https://qiita.com/yuta3003/items/902dc18c6618456c7010">Pythonで学ぶWebの基本と実践</a></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>第5回</strong></td>
<td style="text-align: center;">Streamlitを使ってみよう</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>第6回</strong></td>
<td style="text-align: center;">Streamlitでリアルタイム画像処理</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>第7回</strong></td>
<td style="text-align: center;">リアルタイムで顔検出を行ってみよう</td>
</tr>
</tbody>
</table>
<h1
id="リアルタイムで顔検出を行うアプリを作成してみよう"><strong>リアルタイムで顔検出を行うアプリを作成してみよう</strong></h1>
<h2 id="概要"><strong>概要</strong></h2>
<p>YOLOを用いて物体検出を行い、StreamlitでWebアプリケーションとして実装してみよう。</p>
<h2 id="yoloとは"><strong>YOLOとは</strong></h2>
<p>YOLO（You Only Look
Once）は、ディープラーニングに基づいた物体検出アルゴリズムであり、高速かつ効率的な検出を実現する。</p>
<h3 id="メリット"><strong>メリット</strong></h3>
<ul>
<li><strong>高速</strong>: リアルタイム処理が可能</li>
<li><strong>検出精度が高い</strong>:
最新のモデルでは高精度な検出が可能</li>
<li><strong>導入が簡単</strong>: 事前学習済みモデルを利用可能</li>
</ul>
<h3 id="デメリット"><strong>デメリット</strong></h3>
<ul>
<li><strong>小さな物体や遠くの物体の検出精度が低い</strong></li>
<li><strong>重なり合った物体の検出精度が低い</strong></li>
<li><strong>複数の物体が検出された場合、精度が低下することがある</strong></li>
</ul>
<h2
id="webアプリケーション作成"><strong>Webアプリケーション作成</strong></h2>
<h3
id="ライブラリをインストール"><strong>ライブラリをインストール</strong></h3>
<pre><code>pip install ultralytics streamlit opencv-python numpy</code></pre>
<ul>
<li><code>ultralytics</code>: YOLOを提供するライブラリ</li>
<li><code>streamlit</code>: Web UIを作成するライブラリ</li>
<li><code>opencv-python</code>:
カメラ映像の取得・処理に必要なライブラリ</li>
<li><code>numpy</code>: 画像データ処理に必要なライブラリ</li>
</ul>
<h3
id="プログラムファイル作成"><strong>プログラムファイル作成</strong></h3>
<p>以下内容を<code>st-yolo.py</code>として作成し、保存する</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ultralytics <span class="im">import</span> YOLO</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load YOLO model</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> YOLO(<span class="st">&quot;yolov8n.pt&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Streamlit app setup</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>st.title(<span class="st">&quot;Real-time Object Detection (YOLOv8 + Web Camera)&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>start_button <span class="op">=</span> st.button(<span class="st">&quot;Start Camera&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>stop_button <span class="op">=</span> st.button(<span class="st">&quot;Stop Camera&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>FRAME_WINDOW <span class="op">=</span> st.image([])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Camera setup</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>camera <span class="op">=</span> cv2.VideoCapture(<span class="dv">0</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># App state</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;running&#39;</span> <span class="kw">not</span> <span class="kw">in</span> st.session_state:</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    st.session_state[<span class="st">&#39;running&#39;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Button actions</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> start_button:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    st.session_state[<span class="st">&#39;running&#39;</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> stop_button:</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    st.session_state[<span class="st">&#39;running&#39;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Real-time object detection</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> st.session_state[<span class="st">&#39;running&#39;</span>]:</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        _, frame <span class="op">=</span> camera.read()</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> frame <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            st.write(<span class="st">&quot;Camera disconnected or unavailable.&quot;</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            st.session_state[<span class="st">&#39;running&#39;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        frame <span class="op">=</span> cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> model(frame)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        annotated_frame <span class="op">=</span> results[<span class="dv">0</span>].plot()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        FRAME_WINDOW.image(annotated_frame, channels<span class="op">=</span><span class="st">&quot;RGB&quot;</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> st.session_state[<span class="st">&#39;running&#39;</span>]:</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    st.write(<span class="st">&quot;Camera stopped.&quot;</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>camera.release()</span></code></pre></div>
<h3 id="プログラムを起動"><strong>プログラムを起動</strong></h3>
<pre><code>streamlit run st-yolo.py</code></pre>
